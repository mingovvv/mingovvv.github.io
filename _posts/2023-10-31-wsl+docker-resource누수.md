---
title: ðŸ˜‚ WSL2 + Dockerì—ì„œ ë°œìƒí•˜ëŠ” ë©”ëª¨ë¦¬ ì´ìŠˆ...!?
author: mingo
date: 2023-10-31 09:30:00 +0900
categories: [docker, wsl2]
tags: [docker, wsl2, vmmem]
---

-----

### vmmem ë©”ëª¨ë¦¬ ì´ìŠˆ
WSL2 ê¸°ë°˜ìœ¼ë¡œ dockerë¥¼ ì‚¬ìš©í•˜ë‹¤ë³´ë©´ ë…¸íŠ¸ë¶ íŒ¬ ëŒì•„ê°€ëŠ” ì†Œë¦¬ê°€ ì§„ì§œ ë¬´ì„­ê²Œ ë‚  ë•Œê°€ ì¢…ì¢… ìžˆë‹¤.
ìž‘ì—…ê´€ë¦¬ìžë¥¼ í†µí•´ í”„ë¡œì„¸ìŠ¤ë¥¼ í™•ì¸í•´ë³´ë©´ `vmmem` ì´ë¼ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ê½¤ë‚˜ ë¬´ì„­ê²Œ ëŒì•„ê°€ê³  ìžˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìžˆë‹¤.
![Desktop View](/assets/img/post/202310/2.png){: width="800" height="300" }
_vmmem í”„ë¡œì„¸ìŠ¤_

`vmmem` í”„ë¡œì„¸ìŠ¤ëŠ” ìš´ì˜ ì²´ì œê°€ ê°€ìƒ ë¨¸ì‹ ì— ì˜í•´ ì‚¬ìš©ë˜ëŠ” ë©”ëª¨ë¦¬ì™€ CPU ë¦¬ì†ŒìŠ¤ë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ í•©ì„±í•˜ëŠ” ê°€ì„± í”„ë¡œì„¸ìŠ¤ì´ê³  ì‹¤ì œ ì‚¬ìš©í•˜ê³  ìžˆëŠ”
WSL2ì™€ dockerì˜ ì‚¬ìš©ìœ¼ë¡œ ë©”ëª¨ë¦¬ê°€ ì ìœ ëœë‹¤.

ê·¸.ëŸ°.ë°... ë‚´ê°€ ì§ì ‘ ì»¨í…Œì´ë„ˆë¡œ ë„ì›Œì„œ ì‚¬ìš©ì¤‘ì¸ ë©”ëª¨ë¦¬ì— ëŒ€í•´ì„œëŠ” í•  ë§ ì—†ì§€ë§Œ, ì»¨í…Œì´ë„ˆë¥¼ ì¢…ë£Œí•´ë„ ë©”ëª¨ë¦¬ê°€ ëŒì•„ì˜¤ì§€ ì•ŠëŠ” ì´ìŠˆê°€ ìžˆë‹¤.

### ì›ì¸ì€?
ë¦¬ëˆ…ìŠ¤ì˜ ê¸°ë³¸ì ìœ¼ë¡œ íŒŒì¼ì— ì•¡ì„¸ìŠ¤ í•  ë•Œ, RAM ë©”ëª¨ë¦¬ë¥¼ ìµœëŒ€í•œ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ì •ë³´ë¥¼ ìºì‹œë¡œ ë³´ì¡´í•˜ëŠ” ë™ìž‘ì„ ë°˜ë³µí•œë‹¤. 
WSL2ì— í• ë‹¹ëœ RAMì´ ë¶€ì¡±í•´ì§€ë©´ í˜¸ìŠ¤íŠ¸PCì˜ ë©”ëª¨ë¦¬ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ì „ë‹¬í•˜ì—¬ ë¦¬ëˆ…ìŠ¤ ìºì‹œìª½ì— ë©”ëª¨ë¦¬ê°€ ëª°ë ¤ìžˆëŠ” ì´ìŠˆê°€ ë°œìƒí•œë‹¤.     
ê¸°ë³¸ì ìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ PCì˜ 80%ê¹Œì§€ ë©”ëª¨ë¦¬ë¥¼ ë•¡ê²¨ì“¸ìˆ˜ ìžˆë‹¤ê³  í•˜ë‹ˆ ì¾Œì í™˜ ê°œë°œí™˜ê²½ì„ ìœ„í•´ì„  ì ì ˆí•œ ê´€ë¦¬ê°€ í•„ìš”í•˜ë‹¤.

### í•´ê²°ë°©ë²•

#### 1. wsl --shutdown
`wsl --shutdown` ê°œì¸ì ìœ¼ë¡œ ê°€ìž¥ ë§Žì´ ì‚¬ìš©í–ˆë˜ ë°©ë²•ì´ë‹¤. ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ êµ³ì´ ë©”ëª¨ë¦¬ë¥¼ ì ìœ í•˜ë„ë¡ ë†”ë‘˜ í•„ìš”ë„ ì—†ë‹¤.

#### 2. í• ë‹¹ì‹œí‚¬ ë©”ëª¨ë¦¬ í†µì œ
`%USERPROFILE%/.wslconfig` íŒŒì¼ì„ ìƒì„±í•˜ê³  í• ë‹¹ ë©”ëª¨ë¦¬ ì–‘ í†µì œí•˜ëŠ” ë°©ë²•ì´ë‹¤.
```text
[wsl2]
memory=4GB
```
í• ë‹¹ì‹œí‚¬ ë©”ëª¨ë¦¬ë¥¼ 4GBë¡œ ì œí•œí•˜ëŠ” ë°©ë²•ì´ë‹¤. ë¡œì»¬ì—ì„œëŠ” ë³„ ë¬¸ì œ ì—†ê² ì§€ë§Œ ì‚¬ì‹¤ ì‚¬ìš©í•˜ëŠ” ë©”ëª¨ë¦¬ë¥¼ ì œí•œí•˜ëŠ” ê²ƒì´ ì© ì¢‹ì•„ë³´ì´ì§€ ì•Šê³  ê·€ì°®ì„ ê²ƒ ê°™ë‹¤. 
íŒŒì¼ì„ ì €ìž¥í•œë’¤ `wsl --shutdown` ëª…ë ¹ì–´ë¥¼ í†µí•´ ìž¬ê¸°ë™í•´ì•¼ ì ìš©ëœë‹¤.

#### 3. autoMemoryReclaim=gradual
ë§ˆì§€ë§‰ ë°©ë²•ì€ ì•½ê°„ ê°ë™ì´ë‹¤. ë©”ëª¨ë¦¬ê°€ í•´ì œë˜ì§€ ì•ŠëŠ” ì´ ì´ìŠˆëŠ” 1ë…„ì´ ë„˜ë„ë¡ ì‚¬ëžŒë“¤ ì‚¬ì´ì—ì„œ ë¬¸ì œê°€ ì œê¸°ë˜ì—ˆì§€ë§Œ MSì¸¡ì—ì„œë„ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•˜ì§€ ëª»í•œ ë¬¸ì œì˜€ë‹¤.
> https://github.com/microsoft/WSL/issues/4166

![Desktop View](/assets/img/post/202310/5.png){: width="1000" height="800" }
_2019ë…„ë¶€í„° ã…Žã…Ž_

ê·¸ëŸ°ë° 2023ë…„ 9ì›” WSL ìƒˆë¡œìš´ ë¦´ë¦¬ì¦ˆ ë²„ì „(2.0.0)ì—ì„œ ë©”ëª¨ë¦¬ íšŒìˆ˜ì— ëŒ€í•œ ì‹¤í—˜ì  ê¸°ëŠ¥ì„ ì¶œì‹œí–ˆë‹¤.   
![Desktop View](/assets/img/post/202310/6.png){: width="800" height="450" }
_ë”°ëˆ ë”°ëˆ ì†Œì‹_

![Desktop View](/assets/img/post/202310/7.png){: width="800" height="450" }

ê°„ë‹¨í•˜ê²Œ ë‚´ìš©ì„ ì‚´íŽ´ë³´ë©´ ìºì‹œí™”ëœ ë©”ëª¨ë¦¬ë¥¼ íšŒìˆ˜í•˜ì—¬ WSL VMì˜ ë©”ëª¨ë¦¬ë¥¼ ì¶•ì†Œí•˜ëŠ” ê¸°ëŠ¥ì´ ì‹¤í—˜ì  ê¸°ëŠ¥ìœ¼ë¡œ ì¶œì‹œë˜ì—ˆë‹¤ê³  í•œë‹¤.

ìœ í›„ CPU ì‚¬ìš©ëŸ‰ì„ ê°ì§€í•œ í›„ ìºì‹œëœ ë©”ëª¨ë¦¬ë¥¼ ìžë™ìœ¼ë¡œ íšŒìˆ˜í•˜ëŠ”ë° ì ì§„ì ì¸ ë°©ì‹ìœ¼ë¡œ íšŒìˆ˜í•˜ëŠ” `gradual`, ìºì‹œ ë©”ëª¨ë¦¬ë¥¼ ë“œëžì‹œí‚¤ëŠ” `dropcache` ë‘ê°€ì§€ ì˜µì…˜ì„ ì œê³µí•œë‹¤.
`gradual` ì˜µì…˜ì€ ìœ í›„ ìƒíƒœê°€ 5ë¶„ì´ìƒ ì§€ì† ì‹œ, ë©”ëª¨ë¦¬ íšŒìˆ˜ë¥¼ ì‹œìž‘í•œë‹¤ê³  í•˜ë‹ˆ í˜„ìž¬ë¡œì„  ê°€ìž¥ ì¢‹ì€ ëŒ€ì•ˆì´ ì•„ë‹ê¹Œ ì‹¶ë‹¤.

ì‚¬ìš©ë²•ì€ `%USERNAME%/.wslconfig` ê²½ë¡œì— íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ëž˜ í…ìŠ¤íŠ¸ë¥¼ ìž…ë ¥í•˜ë©´ ëœë‹¤. wsl ìž¬ê¸°ë™ì€ í•„ìˆ˜~
```text
[experimental]
autoMemoryReclaim=gradual
```

> wsl 2023 release ìœ íŠ­ : https://www.youtube.com/watch?v=OB2Rfzy5V0Y
> wsl 2023 release ë¸”ë¡œê·¸ : https://devblogs.microsoft.com/commandline/windows-subsystem-for-linux-september-2023-update/
